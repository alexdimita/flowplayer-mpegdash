/*!

   MPEG-DASH engine plugin for Flowplayer HTML5

   requires:
   - Flowplayer HTML5 version 6.x or greater
   - dash.js https://github.com/Dash-Industry-Forum/dash.js

*/(function(){var e=function(n,r){var i=flowplayer.bean,s=flowplayer.common,o,u,a=new Dash.di.DashContext,f={engineName:e.engineName,pick:function(e){var t,n;for(t=0;t<e.length;t+=1){n=e[t];if(n.type=="application/dash+xml")return n}},load:function(e){s.removeNode(s.findDirect("video",r)[0]||s.find(".fp-player > video",r)[0]),u=s.createElement("video"),i.on(u,"play",function(){n.trigger("resume",[n])}),i.on(u,"pause",function(){n.trigger("pause",[n])}),i.on(u,"timeupdate",function(){n.trigger("progress",[n,u.currentTime])}),i.on(u,"loadedmetadata",function(){e.duration=e.seekable=u.duration,n.trigger("ready",[n,e])}),i.on(u,"seeked",function(){n.trigger("seek",[n,u.currentTime])}),i.on(u,"progress",function(){try{var t=u.buffered,r=t.end(0),i=u.currentTime,s=0,o;if(i)for(o=1;o<t.length;o+=1)s=t.end(o),s>=i&&t.start(o)<=i&&(r=s);e.buffer=r}catch(a){}n.trigger("buffer",[n])}),i.on(u,"ended",function(){n.trigger("finish",[n])}),i.on(u,"volumechange",function(){n.trigger("volume",[n,u.volume])}),u.className="fp-engine mpegdash-engine",s.prepend(s.find(".fp-player",r)[0],u),o=new MediaPlayer(a),o.setAutoPlay(n.conf.autoplay||n.conf.splash),o.startup(),o.attachView(u),o.attachSource(e.src)},resume:function(){var e=o||u;n.finished&&(u.currentTime=0),e.play()},pause:function(){u.pause()},seek:function(e){if(u.paused){var t=u.volume,n=o||u;u.volume=0,n.play(),i.one(u,"seeked.dashpaused",function(){setTimeout(function(){u.pause(),u.volume=t},10)})}o?o.seek(e):u.currentTime=e},volume:function(e){u!==undefined&&(u.volume=e)},speed:function(e){u.playbackRate=e,n.trigger("speed",[n,e])},unload:function(){o&&o.reset(),s.removeNode(u),n.trigger("unload",[n])}};return f};e.engineName="mpegdash",e.canPlay=function(e){var t=window;return flowplayer.support.video&&typeof t.MediaSource=="function"&&t.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640029, mp4a.40.5"')&&e=="application/dash+xml"},flowplayer.engines.push(e)})();