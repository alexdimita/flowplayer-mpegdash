/*!

   MPEG-DASH engine plugin for Flowplayer HTML5

   requires:
   - Flowplayer HTML5 version 6.x or greater
   - dash.js https://github.com/Dash-Industry-Forum/dash.js

*/(function(){var e=window,t=flowplayer.support.video&&typeof e.MediaSource=="function"&&e.MediaSource.isTypeSupported('video/mp4; codecs="avc1.640029, mp4a.40.5"'),n=function(t,r){var i=flowplayer.bean,s=flowplayer.common,o,u,a=!1,f=!1,l=new Dash.di.DashContext,c={engineName:n.engineName,pick:function(e){var t,n;for(t=0;t<e.length;t+=1){n=e[t];if(n.type=="application/dash+xml")return n}},load:function(e){s.removeNode(s.findDirect("video",r)[0]||s.find(".fp-player > video",r)[0]),u=s.createElement("video"),i.on(u,"play",function(){t.trigger("resume",[t])}),i.on(u,"pause",function(){t.trigger("pause",[t])}),i.on(u,"timeupdate",function(){t.trigger("progress",[t,u.currentTime])}),i.on(u,"loadeddata",function(){flowplayer.extend(e,{duration:u.duration,seekable:u.seekable.end(null),width:u.videoWidth,height:u.videoHeight,url:u.currentSrc}),t.trigger("ready",[t,e]),a=s.hasClass(r,"is-poster")}),i.on(u,"seeked",function(){t.trigger("seek",[t,u.currentTime])}),i.on(u,"progress",function(n){try{var r=u.buffered,i=r.end(0),s=u.currentTime,o=0,a;if(s)for(a=1;a<r.length;a+=1)o=r.end(a),o>=s&&r.start(a)<=s&&(i=o);e.buffer=i}catch(f){}t.trigger("buffer",[t,n])}),i.on(u,"ended",function(){t.trigger("finish",[t])}),i.on(u,"volumechange",function(){t.trigger("volume",[t,u.volume])}),u.className="fp-engine mpegdash-engine",s.prepend(s.find(".fp-player",r)[0],u),o=new MediaPlayer(l),o.setAutoPlay(t.conf.autoplay||t.conf.splash),o.setScheduleWhilePaused(!0),o.startup(),o.attachView(u),o.attachSource(e.src)},resume:function(){t.finished&&(u.currentTime=0),u.play()},pause:function(){u.pause()},seek:function(e){u.paused&&i.one(u,"seeked.dashpaused",function(){setTimeout(function(){u.pause(),f&&(t.one("resume.dashstop",function(){s.removeClass(r,"is-poster")}),s.addClass(r,"is-poster"),f=!1)},1)}),u.currentTime=e},volume:function(e){u&&(u.volume=e)},speed:function(e){u.playbackRate=e,t.trigger("speed",[t,e])},unload:function(){o&&o.reset(),s.removeNode(u),t.trigger("unload",[t])}};return t.on("stop",function(){f=a}),c};n.engineName="mpegdash",n.canPlay=function(e){return t&&e=="application/dash+xml"},flowplayer.engines.push(n)})();